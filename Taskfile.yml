version: '3'

vars:
  BINARY_NAME: mysqlmcp
  CLIENT_BINARY_NAME: mysqlmcp-client
  CONFIG: config.toml


tasks:
  default:
    desc: List available tasks
    cmds:
      - task --list

  build:
    desc: Build the binary
    cmds:
      - mkdir -p bin
      - go build -o bin/{{.BINARY_NAME}} .
      - go build -o bin/{{.CLIENT_BINARY_NAME}} ./cmd/client
    sources:
      - '**/*.go'
      - go.mod
      - go.sum
    generates:
      - bin/{{.BINARY_NAME}}
      - bin/{{.CLIENT_BINARY_NAME}}

  test:
    desc: Run tests
    cmds:
      - go test ./... -count=1

  run:
    desc: Run the server with a config file
    cmds:
      - go run . -config {{.CONFIG}}

  fmt:
    desc: Format Go code
    cmds:
      - gofmt -w .

  tidy:
    desc: Tidy go.mod and go.sum
    cmds:
      - go mod tidy
